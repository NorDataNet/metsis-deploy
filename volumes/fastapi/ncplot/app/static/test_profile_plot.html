<!DOCTYPE html>
<html>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-2.0.2.min.js"></script>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-2.0.2.min.js"></script>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-tables-2.0.2.min.js"></script>

<head>
    <title>Download</title>
    <link href="styles.css" rel="stylesheet">
</head>

<body>
<div id="loader"></div>
<script>
function hideme(n) {
  var x = document.getElementById(n);
  if (x.style.visibility === "hidden") {
    x.style.visibility = "visible";
  } else {
    x.style.visibility = "hidden";
  }
}
</script>



<script>
    fetch('http://127.0.0.1:7000/ncplot/plot?get=param&resource_url=http://hyrax:8080/opendap/itp01_itp1grd2042.nc')
  .then(response => response.json())
  .then(data => {
    for (const variable of data.x_axis) {
      console.log(variable);
      var el = document.createElement("option");
      el.textContent = variable;
      el.value = variable;
      document.getElementById("var_selector").appendChild(el);
      document.getElementById("loader").style.display = "none";
    }
  });
</script>

<select id="var_selector" name="source" onchange="myFunction()">
     <option>Choose a variable</option>
</select>

    <script>
        function myFunction() {
            document.getElementById('tsplot').innerHTML = "";
            document.getElementById("loader").style.display = "block";
            var variable = document.getElementById("var_selector").value;
        fetch(
                'http://127.0.0.1:7000/ncplot/plot?get=plot&resource_url=http://hyrax:8080/opendap/itp01_itp1grd2042.nc&metadata=true&variable='+variable)
            .then(function (response) {
                return response.json();
            })
            .then(function (item) {
                Bokeh.embed.embed_item(item);
                document.getElementById("loader").style.display = "none";
                document.getElementById("tsplot").style.display = "block";
            })

        }
    </script>

<div id="tsplot"></div>

</body>
</html>